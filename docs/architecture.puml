@startuml Banking API Architecture

!theme plain
top to bottom direction
skinparam nodesep 40
skinparam ranksep 50
skinparam padding 6
skinparam defaultFontSize 13
skinparam RectangleFontSize 14
skinparam RectangleFontStyle bold

skinparam Arrow {
  Color #34495E
  FontSize 11
  FontColor #2C3E50
  Thickness 1.5
}

' ========== ROW 1: CLIENT ==========
rectangle "Client Layer" #E8EAF6 {
  rectangle "Client (Postman / Browser)" as Client #607D8B;text:white
}

' ========== ROW 2: SECURITY ==========
rectangle "Security Layer" #FFEBEE {
  rectangle "SecurityConfig" as SecurityConfig #C2185B;text:white
  rectangle "JwtAuthenticationFilter" as JwtFilter #E91E63;text:white
  rectangle "JwtUtil" as JwtUtil #880E4F;text:white
}

' ========== ROW 3: CONTROLLERS ==========
rectangle "Controller Layer" #BBDEFB {
  rectangle "AuthController\n/api/auth" as AuthCtrl #2196F3;text:white
  rectangle "AccountController\n/api/accounts" as AccCtrl #1976D2;text:white
  rectangle "UserController\n/api/admin" as UserCtrl #1565C0;text:white
}

' ========== ROW 4: SERVICES ==========
rectangle "Service Layer" #C8E6C9 {
  rectangle "MyUserDetailsService" as UserDetailsSvc #2E7D32;text:white
  rectangle "AccountService" as AccSvc #4CAF50;text:white
  rectangle "UserService" as UserSvc #388E3C;text:white
}

' ========== ROW 5: MAPPER + DTO (side by side) ==========
rectangle "Mapper Layer" #FFE0B2 {
  rectangle "AccountResponseMapper" as AccMapper #FF9800;text:white
  rectangle "TransactionMapper" as TxMapper #F57C00;text:white
  rectangle "UserMapper" as UsrMapper #E65100;text:white
}

rectangle "DTO Layer" #FFCCBC {
  rectangle "Request DTOs\nDeposit | Withdraw | Transfer" as ReqDTOs #FF8A65;text:white
  rectangle "Response DTOs\nAccountResponse | TransactionResponse\nAccountSummary | UserSummary" as RespDTOs #FF7043;text:white
}

' ========== ROW 6: REPOSITORIES ==========
rectangle "Repository Layer" #FFCDD2 {
  rectangle "UserRepository" as UserRepo #D32F2F;text:white
  rectangle "AccountRepository" as AccRepo #F44336;text:white
  rectangle "TransactionRepository" as TxRepo #C62828;text:white
}

' ========== ROW 7: MODELS ==========
rectangle "Model / Entity Layer" #FFF3E0 {
  rectangle "User" as UserModel #FF9800;text:white
  rectangle "Account" as AccModel #FB8C00;text:white
  rectangle "Transaction" as TxModel #F57C00;text:white
}

' ========== ROW 8: DATABASE ==========
rectangle "MySQL Database" #F5F5F5 {
  rectangle "users" as UsersTable #FFF9C4
  rectangle "accounts" as AccountsTable #FFF9C4
  rectangle "transactions" as TxTable #FFF9C4
}

' ========== ARROWS ==========

' Row 1 -> Row 2  (Client = gray #607D8B)
Client -[#607D8B,bold]down-> JwtFilter : HTTP Request (Bearer Token)

' Within Security  (Security = pink/red #E91E63)
SecurityConfig -[#C2185B]right-> JwtFilter : configures
JwtFilter -[#E91E63]right-> JwtUtil : validate token

' Row 2 -> Row 3  (Security = pink #E91E63)
JwtFilter -[#E91E63]down-> AuthCtrl : authenticate
JwtFilter -[#E91E63]down-> AccCtrl : authenticate
JwtFilter -[#E91E63]down-> UserCtrl : authenticate

' Row 3 -> Row 4  (Controller = blue #1976D2)
AuthCtrl -[#2196F3]down-> UserDetailsSvc : login
AuthCtrl -[#2196F3]up-> JwtUtil : generate token
AccCtrl -[#1976D2]down-> AccSvc : delegate
UserCtrl -[#1565C0]down-> AccSvc : get all accounts
UserCtrl -[#1565C0]down-> UserSvc : get all users

' Row 4 -> Row 5  (Service = green #4CAF50)
AccSvc -[#4CAF50]down-> TxMapper : map transactions

' Row 3 -> Row 5  (Controller = blue #1976D2)
AccCtrl -[#1976D2]down-> AccMapper : map response
AccCtrl -[#1976D2]down-> TxMapper : map response
UserCtrl -[#1565C0]down-> UsrMapper : map response
AccCtrl -[#1976D2]down-> ReqDTOs : accepts
AccCtrl -[#1976D2]down-> RespDTOs : returns

' Row 5: Mappers produce DTOs  (Mapper = orange #FF9800)
AccMapper -[#FF9800]right-> RespDTOs : creates
TxMapper -[#F57C00]right-> RespDTOs : creates
UsrMapper -[#E65100]right-> RespDTOs : creates

' Row 4 -> Row 6  (Service = green #4CAF50)
UserDetailsSvc -[#2E7D32]down-> UserRepo : findByUsername
AccSvc -[#4CAF50]down-> AccRepo : CRUD
AccSvc -[#4CAF50]down-> UserRepo : find owner
AccSvc -[#4CAF50]down-> TxRepo : log transaction
UserSvc -[#388E3C]down-> UserRepo : findAll
AuthCtrl -[#2196F3]down-> UserRepo : register

' Row 6 -> Row 7  (Repository = red #F44336)
UserRepo -[#D32F2F]down-> UserModel : manages
AccRepo -[#F44336]down-> AccModel : manages
TxRepo -[#C62828]down-> TxModel : manages

' Row 7 -> Row 8  (Model = orange #FB8C00)
UserModel -[#FF9800]down-> UsersTable : JPA / Hibernate
AccModel -[#FB8C00]down-> AccountsTable : JPA / Hibernate
TxModel -[#F57C00]down-> TxTable : JPA / Hibernate

' FK relationships within DB  (DB = yellow/dark #B7950B)
AccountsTable -[#B7950B,dashed]right-> UsersTable : FK user_id
TxTable -[#B7950B,dashed]left-> AccountsTable : FK account_id
TxTable -[#B7950B,dashed]right-> UsersTable : FK initiator_id

' Entity relationships  (Model = orange #FB8C00)
AccModel -[#FB8C00,dashed]left-> UserModel : @ManyToOne
TxModel -[#F57C00,dashed]left-> AccModel : @ManyToOne
TxModel -[#F57C00,dashed]right-> UserModel : @ManyToOne

@enduml
